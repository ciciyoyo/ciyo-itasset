<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciyocloud.itam.mapper.ConsumableTransactionsMapper">

    
    <select id="selectPageVo" resultType="com.ciyocloud.itam.vo.ConsumableTransactionsVO">
        SELECT
            t1.*,
            t2.name AS consumableName,
            t3.nick_name AS operatorName,
            COALESCE(t4.nick_name, t5.name) AS targetName
        FROM itam_consumable_transactions t1
        LEFT JOIN itam_consumables t2 ON t1.consumable_id = t2.id
        LEFT JOIN sys_user t3 ON t1.operator_id = t3.id
        LEFT JOIN sys_user t4 ON t1.target_id = t4.id AND t1.target_type = 'USER'
        LEFT JOIN itam_device t5 ON t1.target_id = t5.id AND t1.target_type = 'ASSET'
        ${ew.customSqlSegment}
    </select>
</mapper>
